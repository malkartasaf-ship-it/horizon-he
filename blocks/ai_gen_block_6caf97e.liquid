{% doc %}
  @prompt
    Grid gallery
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-grid-gallery-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    padding: {{ block.settings.section_padding }}px 0;
  }

  @media screen and (min-width: 750px) {
    .ai-grid-gallery-{{ ai_gen_id }} {
      width: {{ block.settings.desktop_width_percent }}%;
      margin: 0 auto;
    }
  }

  .ai-grid-gallery-container-{{ ai_gen_id }} {
    display: grid;
    gap: {{ block.settings.gap }}px;
    width: 100%;
  }

  @media screen and (max-width: 749px) {
    .ai-grid-gallery-container-{{ ai_gen_id }} {
      grid-template-columns: repeat({{ block.settings.columns_mobile }}, 1fr);
    }
  }

  @media screen and (min-width: 750px) {
    .ai-grid-gallery-container-{{ ai_gen_id }} {
      grid-template-columns: repeat({{ block.settings.columns_desktop }}, 1fr);
    }
  }

  .ai-grid-gallery-item-{{ ai_gen_id }} {
    position: relative;
    overflow: hidden;
    border-radius: {{ block.settings.image_border_radius }}px;
    aspect-ratio: {{ block.settings.aspect_ratio }};
    background-color: #f4f4f4;
  }

  .ai-grid-gallery-image-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .ai-grid-gallery-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f4f4f4;
  }

  .ai-grid-gallery-placeholder-{{ ai_gen_id }} svg {
    width: 50%;
    height: 50%;
    opacity: 0.3;
  }

  {% if block.settings.enable_overlay %}
    .ai-grid-gallery-overlay-{{ ai_gen_id }} {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: {{ block.settings.overlay_color }};
      opacity: 0;
      transition: opacity 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .ai-grid-gallery-item-{{ ai_gen_id }}:hover .ai-grid-gallery-overlay-{{ ai_gen_id }} {
      opacity: {{ block.settings.overlay_opacity | divided_by: 100.0 }};
    }

    .ai-grid-gallery-overlay-text-{{ ai_gen_id }} {
      color: {{ block.settings.overlay_text_color }};
      font-size: {{ block.settings.overlay_text_size }}px;
      text-align: center;
      font-weight: 600;
    }
  {% endif %}

  {% if block.settings.enable_lightbox %}
    .ai-grid-gallery-item-{{ ai_gen_id }} {
      cursor: pointer;
    }

    .ai-grid-gallery-lightbox-{{ ai_gen_id }} {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .ai-grid-gallery-lightbox-{{ ai_gen_id }}.active {
      display: flex;
    }

    .ai-grid-gallery-lightbox-content-{{ ai_gen_id }} {
      position: relative;
      max-width: 90%;
      max-height: 90%;
    }

    .ai-grid-gallery-lightbox-image-{{ ai_gen_id }} {
      max-width: 100%;
      max-height: 90vh;
      object-fit: contain;
    }

    .ai-grid-gallery-lightbox-close-{{ ai_gen_id }} {
      position: absolute;
      top: -40px;
      right: 0;
      background: none;
      border: none;
      color: #ffffff;
      font-size: 32px;
      cursor: pointer;
      padding: 10px;
      line-height: 1;
    }

    .ai-grid-gallery-lightbox-close-{{ ai_gen_id }}:hover {
      opacity: 0.7;
    }
  {% endif %}
{% endstyle %}

<grid-gallery-{{ ai_gen_id }} class="ai-grid-gallery-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-grid-gallery-container-{{ ai_gen_id }}">
    {% for i in (1..12) %}
      {% liquid
        assign image_key = 'image_' | append: i
        assign caption_key = 'caption_' | append: i
        assign image = block.settings[image_key]
        assign caption = block.settings[caption_key]
      %}

      {% if image != blank %}
        <div class="ai-grid-gallery-item-{{ ai_gen_id }}" data-index="{{ i }}">
          <img
            src="{{ image | image_url: width: 800 }}"
            alt="{{ image.alt | escape }}"
            loading="lazy"
            width="{{ image.width }}"
            height="{{ image.height }}"
            class="ai-grid-gallery-image-{{ ai_gen_id }}"
          >
          {% if block.settings.enable_overlay and caption != blank %}
            <div class="ai-grid-gallery-overlay-{{ ai_gen_id }}">
              <div class="ai-grid-gallery-overlay-text-{{ ai_gen_id }}">{{ caption }}</div>
            </div>
          {% endif %}
        </div>
      {% endif %}
    {% endfor %}
  </div>

  {% if block.settings.enable_lightbox %}
    <div class="ai-grid-gallery-lightbox-{{ ai_gen_id }}">
      <div class="ai-grid-gallery-lightbox-content-{{ ai_gen_id }}">
        <button class="ai-grid-gallery-lightbox-close-{{ ai_gen_id }}" aria-label="Close">Ã—</button>
        <img src="" alt="" class="ai-grid-gallery-lightbox-image-{{ ai_gen_id }}">
      </div>
    </div>
  {% endif %}
</grid-gallery-{{ ai_gen_id }}>

{% if block.settings.enable_lightbox %}
  <script>
    (function() {
      class GridGallery{{ ai_gen_id }} extends HTMLElement {
        constructor() {
          super();
        }

        connectedCallback() {
          this.items = this.querySelectorAll('.ai-grid-gallery-item-{{ ai_gen_id }}');
          this.lightbox = this.querySelector('.ai-grid-gallery-lightbox-{{ ai_gen_id }}');
          this.lightboxImage = this.querySelector('.ai-grid-gallery-lightbox-image-{{ ai_gen_id }}');
          this.closeButton = this.querySelector('.ai-grid-gallery-lightbox-close-{{ ai_gen_id }}');

          this.setupEventListeners();
        }

        setupEventListeners() {
          this.items.forEach((item) => {
            item.addEventListener('click', () => {
              const img = item.querySelector('.ai-grid-gallery-image-{{ ai_gen_id }}');
              if (img) {
                this.openLightbox(img.src, img.alt);
              }
            });
          });

          this.closeButton.addEventListener('click', () => {
            this.closeLightbox();
          });

          this.lightbox.addEventListener('click', (e) => {
            if (e.target === this.lightbox) {
              this.closeLightbox();
            }
          });

          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && this.lightbox.classList.contains('active')) {
              this.closeLightbox();
            }
          });
        }

        openLightbox(src, alt) {
          this.lightboxImage.src = src;
          this.lightboxImage.alt = alt;
          this.lightbox.classList.add('active');
          document.body.style.overflow = 'hidden';
        }

        closeLightbox() {
          this.lightbox.classList.remove('active');
          document.body.style.overflow = '';
        }
      }

      customElements.define('grid-gallery-{{ ai_gen_id }}', GridGallery{{ ai_gen_id }});
    })();
  </script>
{% endif %}

{% schema %}
{
  "name": "Grid gallery",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "desktop_width_percent",
      "label": "Desktop width",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 100
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Columns on desktop",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Columns on mobile",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ],
      "default": "2"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Gap between images",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "section_padding",
      "label": "Section padding",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "default": 40
    },
    {
      "type": "header",
      "content": "Image style"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "Aspect ratio",
      "options": [
        { "value": "1 / 1", "label": "Square (1:1)" },
        { "value": "4 / 3", "label": "Landscape (4:3)" },
        { "value": "3 / 4", "label": "Portrait (3:4)" },
        { "value": "16 / 9", "label": "Wide (16:9)" }
      ],
      "default": "1 / 1"
    },
    {
      "type": "range",
      "id": "image_border_radius",
      "label": "Border radius",
      "min": 0,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "header",
      "content": "Overlay"
    },
    {
      "type": "checkbox",
      "id": "enable_overlay",
      "label": "Enable overlay on hover",
      "default": true
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay opacity",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "%",
      "default": 60
    },
    {
      "type": "color",
      "id": "overlay_text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "overlay_text_size",
      "label": "Text size",
      "min": 12,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "header",
      "content": "Lightbox"
    },
    {
      "type": "checkbox",
      "id": "enable_lightbox",
      "label": "Enable lightbox",
      "default": true
    },
    {
      "type": "header",
      "content": "Image 1"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_1",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 2"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_2",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 3"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_3",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 4"
    },
    {
      "type": "image_picker",
      "id": "image_4",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_4",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 5"
    },
    {
      "type": "image_picker",
      "id": "image_5",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_5",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 6"
    },
    {
      "type": "image_picker",
      "id": "image_6",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_6",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 7"
    },
    {
      "type": "image_picker",
      "id": "image_7",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_7",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 8"
    },
    {
      "type": "image_picker",
      "id": "image_8",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_8",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 9"
    },
    {
      "type": "image_picker",
      "id": "image_9",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_9",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 10"
    },
    {
      "type": "image_picker",
      "id": "image_10",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_10",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 11"
    },
    {
      "type": "image_picker",
      "id": "image_11",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_11",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Image 12"
    },
    {
      "type": "image_picker",
      "id": "image_12",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_12",
      "label": "Caption"
    }
  ],
  "presets": [
    {
      "name": "Grid gallery"
    }
  ]
}
{% endschema %}